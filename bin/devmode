#!/usr/bin/env bash

SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do # resolve $SOURCE until the file is no longer a symlink
  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE" # if $SOURCE was a relative symlink, we need to resolve it relative to the path where the symlink file was located
done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

source $DIR/../.rc

if [ "$#" = 0 ]; then
    printf "Removing .environment file ([$TDK_HOME/config/config.json] will be used)...\\n"
    [ -f "$TDK_HOME/.environment" ] && rm "$TDK_HOME/.environment"
    exit 0
fi

if [ "$#" = 1 ]; then
    printf "Creating .environment file with '%s' name ([$TDK_HOME/config/config-%s.json] will be used)...\\n" "$1" "$1"
    [ -f "$TDK_HOME/.environment" ] && rm "$TDK_HOME/.environment"
    echo "$1" > "$TDK_HOME/.environment"
    exit 0
fi

printf "usage: devmode <environment_name>\\n"
exit 1
